#+BEGIN_HTML
<a href="https://travis-ci.org/kkholst/mets"><img src="https://travis-ci.org/kkholst/mets.svg?branch=master"></a>
<a href="https://codecov.io/github/kkholst/mets?branch=master"><img src="https://codecov.io/github/kkholst/mets/coverage.svg?branch=master"></a>
<a href="http://cran.rstudio.com/web/packages/mets/index.html"><img src="http://www.r-pkg.org/badges/version/mets"></a>
<a href="http://cranlogs.r-pkg.org/downloads/total/last-month/mets"><img src="http://cranlogs.r-pkg.org/badges/mets"></a>
#+END_HTML

* Multivariate Event Times (=mets=)
  Implementation of various statistical models for multivariate event
  history data. Including multivariate cumulative incidence models,
  and bivariate random effects probit models (Liability models)

** Installation
#+BEGIN_SRC R :exports both :eval never
install.packages("mets",dependencies=TRUE)
#+END_SRC

The development version may be installed directly from github
(requires [[http://cran.r-project.org/bin/windows/Rtools/][Rtools]] on windows
and [[http://cran.r-project.org/bin/macosx/tools/][development tools]] (+Xcode) for Mac OS X):
#+BEGIN_SRC R :exports both :eval never
devtools::install_github("kkholst/mets")
#+END_SRC
or to get development version 
#+BEGIN_SRC R :exports both :eval never
devtools::install_github("kkholst/mets",ref="develop")
#+END_SRC
or download the source 
#+BEGIN_EXAMPLE
git@github.com:kkholst/mets.git
#+END_EXAMPLE

** Citation

To cite the =mets= package please use one of the following references

#+BEGIN_QUOTE
  Klaus K. Holst and Thomas H. Scheike Jacob B. Hjelmborg (2015). 
  The Liability Threshold Model for Censored Twin Data.
  Computational Statistics and Data Analysis. [[http://dx.doi.org/10.1016/j.csda.2015.01.014]]
#+END_QUOTE

#+BEGIN_QUOTE
  Thomas H. Scheike and Klaus K. Holst and Jacob B. Hjelmborg (2013). 
  Estimating heritability for cause specific mortality based on twin studies.
  Lifetime Data Analysis. http://dx.doi.org/10.1007/s10985-013-9244-x
#+END_QUOTE

BibTeX:
#+BEGIN_EXAMPLE

@Manual{metsR,
  title      = {mets: Analysis of Multivariate Event Times},
  author     = {Klaus K. Holst and Thomas Scheike},
  year       = {2014},
  note       = {R package version 1.2.4},
  bdsk-url-1 = {http://lava.r-forge.r-project.org/},
  url        = {http://lava.r-forge.r-project.org/},
}

  @Article{,
    title={The Liability Threshold Model for Censored Twin Data},
    author={Holst, Klaus K. and Scheike, Thomas H. and Hjelmborg, Jacob B.},
    year={2015},
    doi={10.1016/j.csda.2015.01.014},
    url={http://dx.doi.org/10.1016/j.csda.2015.01.014},
    journal={Computational Statistics and Data Analysis}
  }


  @Article{,
    title={Estimating heritability for cause specific mortality based on twin studies},
    author={Scheike, Thomas H. and Holst, Klaus K. and Hjelmborg, Jacob B.},
    year={2013},
    issn={1380-7870},
    journal={Lifetime Data Analysis},
    doi={10.1007/s10985-013-9244-x},
    url={http://dx.doi.org/10.1007/s10985-013-9244-x},
    publisher={Springer US},
    keywords={Cause specific hazards; Competing risks; Delayed entry; 
              Left truncation; Heritability; Survival analysis},
    pages={1-24},
    language={English}
  }
#+END_EXAMPLE
       
** Examples

#+BEGIN_SRC R :exports both :file mets1.png :cache yes
  library(mets)
  
  data(prt) ## Prostate data example (sim)
  
  ## Bivariate competing risk, concordance estimates
  p33 <- bicomprisk(Hist(time,status)~strata(zyg)+id(id),
                    data=prt,cause=c(2,2),return.data=1,prodlim=TRUE)
  
  p33dz <- p33$model$"DZ"$comp.risk
  p33mz <- p33$model$"MZ"$comp.risk
  
  ## Probability weights based on Aalen's additive model 
  prtw <- ipw(Surv(time,status==0)~country, data=prt,
              cluster="id",weightname="w")
  
  
  ## Marginal model (wrongly ignoring censorings)
  bpmz <- biprobit(cancer~1 + cluster(id), 
                   data=subset(prt,zyg=="MZ"), eqmarg=TRUE)
  
  ## Extended liability model
  bpmzIPW <- biprobit(cancer~1 + cluster(id), 
                      data=subset(prtw,zyg=="MZ"), 
                      weight="w")
  smz <- summary(bpmzIPW)
  
  ## Concordance
  plot(p33mz,ylim=c(0,0.1),axes=FALSE,automar=FALSE,atrisk=FALSE)
  axis(2); axis(1)
    
  abline(h=smz$prob["Concordance",],lwd=c(2,1,1),col="darkblue")
  ## Wrong estimates:
  abline(h=summary(bpmz)$prob["Concordance",],lwd=c(2,1,1),col="lightgray")
#+END_SRC

:RESULTS:
[[file:inst/misc/mets1.png]]
:END:

